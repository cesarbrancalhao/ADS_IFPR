<script>
    import { page } from "$app/stores";
    import { goto } from '$app/navigation';

    const back = () => goto('/');
    
    let fl = $page.params.fl;
    let people = [];

    async function getPeople() {
        const url = 'http://localhost:8000/person';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const call = new Function(atob('Y29uc29sZS5sb2coImNlc2FyYnJhbmNhbGhhbyIpOw=='));
        let endpoint;

        if (!isNaN(fl)) endpoint = `${url}/id/${fl}`;
        else endpoint = `${url}/name/${fl}`;

        const res = await fetch(endpoint);
        const data = await res.json();
        
        if (res.ok) return data;
        
        throw new Error(data); 
    }

    getPeople().then(data=>{
        if (data.results && data.results.length > 1) people = data.results;
        else if (data && data.name) people = [data];
        else people = undefined;
    });
</script>

<div class="container">
    <button type="button" onclick="{back}" class="btn" aria-label="Back">Voltar</button>
    {#if people}
        {#each people as person}
            <h2>Nome: {person.name}</h2>
            {#if person.birthday}
                <p>{person.birthday} - {person.deathday ? person.deathday : "Presente"}</p>
            {/if}
            <p>{person.place_of_birth}</p>
            <p class="key">Gênero:</p>
            <p>{person.gender == 1 ? "Feminino" : "Masculino"}</p>
            <p class="key">Popularidade:</p>
            <p>{person.popularity}</p>
            <p class="key">Conhecido por:</p>
            <p>{person.known_for_department}</p>
            {#if person.also_known_as && person.also_known_as.length > 0}
                <p class="key">Apelidos:</p>
                {#each person.also_known_as as ap }
                    <p>{ap}</p>
                {/each}
            {/if}
            <hr />
        {/each}
    {/if}
    {#if people === undefined}
        <p>Pessoa não encontrada</p>
    {/if}
</div>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                {new Function(atob('Y29uc29sZS5sb2coImNlc2FyYnJhbmNhbGhhbyIpOw=='))()}

<style>
    .container {
        text-align: center;
        width: 280px;
        margin: auto;
    }
    .key {
        font-weight: bold;
    }
    .btn {
        margin-top: 1rem;
        padding: 10px;
        border-radius: 10px;
    }
</style>